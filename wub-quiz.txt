# WebQuiz - Starter (Laravel + MySQL)

Dokumen ini berisi panduan lengkap dan file starter untuk membuat **Web Quiz** dengan fitur:

* Sistem penilaian otomatis
* Leaderboard / ranking
* Login user (Laravel Breeze)
* Dashboard admin (CRUD quiz & question)
* API version (Laravel API)
* Tampilan UI modern (Tailwind + Vite)

Semua contoh kode ditulis untuk Laravel 10+ dan MySQL.

---

## 1. Persiapan & Inisialisasi

```bash
# buat project
composer create-project laravel/laravel web-quiz
cd web-quiz

# install auth scaffolding (Breeze)
composer require laravel/breeze --dev
php artisan breeze:install blade
npm install
npm run build

# buat database di MySQL -> `web_quiz`
# atur .env:
# DB_DATABASE=web_quiz
# DB_USERNAME=root
# DB_PASSWORD=secret

php artisan migrate
```

> Di dokumen ini kita pakai **Laravel Breeze** (blade) untuk otentikasi sederhana.

---

## 2. Struktur Database (Migration)

Buat migration & model untuk: `quizzes`, `questions`, `answers`, `results` (penyimpanan jawaban & skor).

### Migration: quizzes

```php
// database/migrations/xxxx_xx_xx_create_quizzes_table.php
public function up()
{
    Schema::create('quizzes', function (Blueprint $table) {
        $table->id();
        $table->string('title');
        $table->text('description')->nullable();
        $table->integer('time_limit_minutes')->nullable();
        $table->boolean('is_published')->default(false);
        $table->timestamps();
    });
}
```

### Migration: questions

```php
// database/migrations/...create_questions_table.php
public function up()
{
    Schema::create('questions', function (Blueprint $table) {
        $table->id();
        $table->foreignId('quiz_id')->constrained()->onDelete('cascade');
        $table->text('question');
        $table->integer('points')->default(1);
        $table->timestamps();
    });
}
```

### Migration: answers

```php
// database/migrations/...create_answers_table.php
public function up()
{
    Schema::create('answers', function (Blueprint $table) {
        $table->id();
        $table->foreignId('question_id')->constrained()->onDelete('cascade');
        $table->string('answer');
        $table->boolean('is_correct')->default(false);
        $table->timestamps();
    });
}
```

### Migration: results

```php
// database/migrations/...create_results_table.php
public function up()
{
    Schema::create('results', function (Blueprint $table) {
        $table->id();
        $table->foreignId('user_id')->constrained()->onDelete('cascade');
        $table->foreignId('quiz_id')->constrained()->onDelete('cascade');
        $table->integer('score')->default(0);
        $table->integer('max_score')->default(0);
        $table->json('answers')->nullable(); // format {question_id: answer_id}
        $table->timestamps();
    });
}
```

---

## 3. Model Relationships

Contoh model singkat:

```php
// app/Models/Quiz.php
class Quiz extends Model
{
    protected $fillable = ['title','description','time_limit_minutes','is_published'];

    public function questions(){
        return $this->hasMany(Question::class);
    }

    public function results(){
        return $this->hasMany(Result::class);
    }
}

// app/Models/Question.php
class Question extends Model
{
    protected $fillable = ['quiz_id','question','points'];

    public function quiz(){ return $this->belongsTo(Quiz::class); }
    public function answers(){ return $this->hasMany(Answer::class); }
}

// app/Models/Answer.php
class Answer extends Model
{
    protected $fillable = ['question_id','answer','is_correct'];

    public function question(){ return $this->belongsTo(Question::class); }
}

// app/Models/Result.php
class Result extends Model
{
    protected $fillable = ['user_id','quiz_id','score','max_score','answers'];
    protected $casts = ['answers' => 'array'];

    public function user(){ return $this->belongsTo(User::class); }
    public function quiz(){ return $this->belongsTo(Quiz::class); }
}
```

---

## 4. Auth & Role (Admin)

Sederhana: tambahkan kolom `is_admin` pada users.

```bash
php artisan make:migration add_is_admin_to_users_table --table=users
```

```php
public function up(){ Schema::table('users', function (Blueprint $table){ $table->boolean('is_admin')->default(false); }); }
```

Tambahkan middleware `IsAdmin`:

```bash
php artisan make:middleware IsAdmin
```

```php
// app/Http/Middleware/IsAdmin.php
public function handle($request, Closure $next)
{
    if(auth()->check() && auth()->user()->is_admin){
        return $next($request);
    }
    abort(403);
}
```

Register middleware di `app/Http/Kernel.php` sebagai `'admin' => \App\Http\Middleware\IsAdmin::class`.

---

## 5. Routes

`routes/web.php` (utama):

```php
use App\Http\Controllers\QuizController;
use App\Http\Controllers\ResultController;
use App\Http\Controllers\Admin\QuizAdminController;

Route::get('/', function(){ return redirect('/quizzes'); });

Route::middleware(['auth'])->group(function(){
    Route::get('/quizzes', [QuizController::class,'index'])->name('quizzes.index');
    Route::get('/quiz/{quiz}', [QuizController::class,'show'])->name('quizzes.show');
    Route::post('/quiz/{quiz}/submit', [ResultController::class,'submit'])->name('quizzes.submit');
    Route::get('/leaderboard', [ResultController::class,'leaderboard'])->name('leaderboard');
});

// Admin
Route::middleware(['auth','admin'])->prefix('admin')->name('admin.')->group(function(){
    Route::resource('quizzes', QuizAdminController::class);
    // nested controllers for questions & answers can be added
});

require __DIR__.'/auth.php';
```

`routes/api.php` (API endpoints):

```php
use App\Http\Controllers\Api\QuizApiController;

Route::middleware('auth:sanctum')->group(function(){
    Route::get('/quizzes', [QuizApiController::class,'index']);
    Route::get('/quizzes/{quiz}', [QuizApiController::class,'show']);
    Route::post('/quizzes/{quiz}/submit', [QuizApiController::class,'submit']);
});
```

> Untuk API auth gunakan `sanctum` jika butuh token-based.

---

## 6. Controller: Scoring & Submission

Logika scoring (otomatis): ketika user submit, kita akan:

1. Ambil semua questions & answers benar dari quiz.
2. Iterasi jawaban user, jumlahkan poin untuk jawaban yang cocok (is_correct).
3. Simpan `Result` dengan `score`, `max_score` (total poin quiz), dan `answers` sebagai JSON.

Contoh `ResultController@submit`:

```php
public function submit(Request $request, Quiz $quiz)
{
    $data = $request->validate([ 'answers' => 'required|array' ]);
    $userAnswers = $data['answers']; // format: [question_id => answer_id]

    $maxScore = $quiz->questions->sum('points');
    $score = 0;

    foreach($quiz->questions as $question){
        if(!isset($userAnswers[$question->id])) continue;
        $answerId = (int)$userAnswers[$question->id];
        $answer = $question->answers->firstWhere('id', $answerId);
        if($answer && $answer->is_correct){
            $score += $question->points;
        }
    }

    $result = Result::create([
        'user_id' => auth()->id(),
        'quiz_id' => $quiz->id,
        'score' => $score,
        'max_score' => $maxScore,
        'answers' => $userAnswers,
    ]);

    return redirect()->route('quizzes.show', $quiz)->with('success', "Skor kamu: {$score}/{$maxScore}");
}
```

---

## 7. Leaderboard

Simple leaderboard: ranking by highest `score` (atau percentage) dan waktu tercepat jika ingin tie-breaker.

```php
public function leaderboard()
{
    $leaders = Result::select('user_id', DB::raw('MAX(score) as best_score'))
        ->groupBy('user_id')
        ->orderByDesc('best_score')
        ->with('user')
        ->take(50)
        ->get();

    return view('leaderboard.index', compact('leaders'));
}
```

Atau ranking per-quiz:

```php
$leaders = Result::where('quiz_id',$quiz->id)
    ->orderByDesc('score')
    ->with('user')
    ->take(50)->get();
```

---

## 8. Admin Dashboard (CRUD)

Buat controller resource `Admin\QuizAdminController` yang handle create/edit/delete quiz, questions, answers.

Contoh routes resource sudah di atas. Di admin view, sediakan nested forms untuk menambah question & answers (JS dynamic) atau CRUD terpisah untuk questions.

---

## 9. API (Laravel API)

Buat `QuizApiController` yang mengembalikan quiz + questions + answers (jangan expose is_correct di public API!). Hanya kembalikan `is_correct` untuk authenticated admin or when submitting check answers server-side.

```php
public function show(Quiz $quiz){
    $quiz->load(['questions.answers' => function($q){ $q->select('id','question_id','answer'); }]);
    return response()->json($quiz);
}
```

Endpoint submit di API akan menerima user answers dan mengembalikan skor.

---

## 10. Frontend: Blade + Tailwind + Vite

Breeze sudah menginstal Tailwind. Buat layout sederhana di `resources/views/layouts/app.blade.php`.

Contoh form quiz (struktur):

```html
<form action="{{ route('quizzes.submit',$quiz) }}" method="POST">
    @csrf
    @foreach($quiz->questions as $q)
        <div class="mb-4">
            <p class="font-semibold">{{ $q->question }}</p>
            @foreach($q->answers as $a)
                <label class="block">
                    <input type="radio" name="answers[{{ $q->id }}]" value="{{ $a->id }}"> {{ $a->answer }}
                </label>
            @endforeach
        </div>
    @endforeach

    <button class="btn">Submit</button>
</form>
```

Untuk UX lebih baik: tambahkan konfirmasi waktu, progress, dan disable back-navigation jika perlu.

---

## 11. Security Notes

* Jangan ever return `is_correct` di API/public view.
* Validate input server-side.
* Rate-limit submit endpoint untuk mencegah brute-force menebak jawaban.
* Sanitasi output (Blade aman secara default).

---

## 12. Deployment & Env

* Gunakan queue & caching jika scale besar.
* Pastikan `APP_ENV=production`, `APP_DEBUG=false`.

---

## 13. Quick Checklist (apa yang sudah dilakukan di repo)

* [ ] Laravel project created
* [ ] Breeze installed & auth working
* [ ] Migrations created (quizzes, questions, answers, results)
* [ ] Models & relationships
* [ ] Admin middleware
* [ ] Routes (web & api)
* [ ] Result submission & scoring logic
* [ ] Leaderboard query
* [ ] Blade views skeleton
* [ ] Tailwind configured

---

## 14. Langkah Selanjutnya yang Bisa Aku Generate Sekarang

* Generate file-by-file: migration, model, controller, view
* Implement full Admin CRUD controllers & views
* Implement API controllers with Sanctum auth
* Implement unit tests untuk scoring
* Buat seeder contoh quiz

Kalau kamu mau, aku bisa langsung **meng-generate file** (mis. `QuizController`, `ResultController`, `QuizAdminController`, migration files, dan beberapa blade views) di turn berikutnya.

---

Jika ada yg mau diubah (misal pakai Jetstream, or ingin user roles lebih kompleks), beri tahu dan aku sesuaikan.
